<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Flashcard Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --primary:#6366f1;
      --primary-dark:#4f46e5;
      --bg:#f1f5f9;
      --card:#ffffff;
      --success:#22c55e;
      --error:#ef4444;
      --muted:#64748b;
    }

    body {
      font-family: "Inter", system-ui, Arial, sans-serif;
      background: linear-gradient(135deg, #eef2ff, #f8fafc);
      margin: 0;
      padding: 20px;
      color:#0f172a;
    }

    h1 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 24px;
    }

    h2 { margin-top:0 }

    .card {
      background: var(--card);
      border-radius: 18px;
      padding: 24px;
      max-width: 820px;
      margin: 0 auto 24px;
      box-shadow: 0 15px 35px rgba(15,23,42,.12);
      animation: fadeIn .4s ease;
    }

    @keyframes fadeIn {
      from { opacity:0; transform: translateY(10px); }
      to { opacity:1; transform: translateY(0); }
    }

    label {
      font-weight: 600;
      margin-top: 14px;
      display:block;
      color:#1e293b;
    }

    input, select {
      width: 100%;
      padding: 12px 14px;
      margin-top: 8px;
      border-radius: 12px;
      border: 1px solid #c7d2fe;
      font-size: 15px;
      outline:none;
    }

    input:focus, select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99,102,241,.2);
    }

    .slider-wrap { margin-top: 10px; }

    .slider-label {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: var(--muted);
      margin-top: 6px;
    }

    button {
      padding: 14px 18px;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all .2s ease;
    }

    button.primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #fff;
      box-shadow: 0 8px 20px rgba(79,70,229,.35);
    }

    button.primary:hover { transform: translateY(-1px); }

    button.secondary {
      background: #eef2ff;
      color: #1e293b;
    }

    button.secondary:hover { background:#e0e7ff; }

    button:disabled { opacity:.6; cursor:not-allowed; box-shadow:none; }

    .question {
      margin-top: 22px;
      padding: 18px;
      border-radius: 16px;
      background: #f8fafc;
      border:1px solid #e5e7eb;
    }

    .options button {
      width: 100%;
      margin-top: 12px;
      text-align: left;
      position: relative;
    }

    .options button.selected {
      background: #c7d2fe;
      border: 2px solid var(--primary);
    }

    .options button.correct {
      background: #dcfce7 !important;
      border: 2px solid var(--success);
    }

    .options button.incorrect {
      background: #fee2e2 !important;
      border: 2px solid var(--error);
    }

    .result {
      text-align: center;
      font-size: 18px;
    }

    .badge {
      display:inline-block;
      padding:6px 12px;
      border-radius:999px;
      font-size:14px;
      font-weight:600;
      margin-top:8px;
    }

    .badge.success { background:#dcfce7; color:#166534 }
    .badge.error { background:#fee2e2; color:#991b1b }
  </style>
</head>
<body>

<h1>üìù Vocabulary Test</h1>

<div class="card" id="config">
  <label>User</label>
  <input id="user" placeholder="VD: sunny@gmail.com" />

  <label>T·ªïng s·ªë t·ª´ ki·ªÉm tra</label>
  <input type="number" id="total" value="10" min="1" />

  <label>C√°ch l·∫•y t·ª´</label>
  <select id="mode">
    <option value="recent">T·ª´ m·ªõi nh·∫•t</option>
    <option value="random">Ng·∫´u nhi√™n</option>
  </select>

  <label>Ph√¢n b·ªë c√¢u h·ªèi</label>
  <div class="slider-wrap">
    <input type="range" id="meaningCount" min="0" value="5" />
    <div class="slider-label">
      <span>Meaning</span>
      <span>Listening</span>
    </div>
    <div id="sliderInfo"></div>
  </div>

  <br />
  <button class="primary" onclick="startTest()">Start</button>
</div>

<div class="card" id="test" style="display:none"></div>
<div class="card" id="result" style="display:none"></div>

<script>
/*********** MOCK DATA (thay b·∫±ng fetch t·ª´ Apps Script) ***********/
const WORDS = [
  { time:'2025-12-17T08:00:00Z', owner:'All', en:'teacher', vi:'gi√°o vi√™n' },
  { time:'2025-12-17T08:00:01Z', owner:'All', en:'student', vi:'h·ªçc sinh' },
  { time:'2025-12-17T08:00:02Z', owner:'sunny@gmail.com', en:'book', vi:'quy·ªÉn s√°ch' },
  { time:'2025-12-17T08:00:03Z', owner:'All', en:'school', vi:'tr∆∞·ªùng h·ªçc' },
  { time:'2025-12-17T08:00:04Z', owner:'sunny@gmail.com', en:'pen', vi:'c√¢y b√∫t' }
];

let questions = [];
let answers = {};

const slider = document.getElementById('meaningCount');
const sliderInfo = document.getElementById('sliderInfo');

slider.oninput = () => updateSlider();

document.getElementById('total').oninput = () => updateSlider();

function updateSlider() {
  const total = +document.getElementById('total').value || 0;
  slider.max = total;
  if (+slider.value > total) slider.value = total;
  sliderInfo.innerText = `Meaning: ${slider.value} | Listening: ${total - slider.value}`;
}
updateSlider();

function shuffle(arr) {
  return [...arr].sort(() => Math.random() - 0.5);
}

function startTest() {
  const user = document.getElementById('user').value.trim();
  const total = +document.getElementById('total').value;
  const meaningCount = +slider.value;
  const listeningCount = total - meaningCount;
  const mode = document.getElementById('mode').value;

  let pool = WORDS.filter(w => w.owner === 'All' || w.owner === user);

  if (mode === 'recent') {
    pool.sort((a,b) => new Date(b.time) - new Date(a.time));
  } else {
    pool = shuffle(pool);
  }

  pool = pool.slice(0, total);

  const meaningWords = shuffle(pool).slice(0, meaningCount);
  const listeningWords = shuffle(pool).slice(0, listeningCount);

  questions = [
    ...meaningWords.map(w => createMeaningQ(w, pool)),
    ...listeningWords.map(w => createListeningQ(w, pool))
  ];

  questions = shuffle(questions);

  document.getElementById('config').style.display = 'none';
  renderTest();
}

function createMeaningQ(word, pool) {
  const options = shuffle([
    word.vi,
    ...shuffle(pool.filter(w => w.vi !== word.vi)).slice(0,3).map(w => w.vi)
  ]);
  return { type:'meaning', en:word.en, options, answer:word.vi };
}

function createListeningQ(word, pool) {
  const options = shuffle([
    word.en,
    ...shuffle(pool.filter(w => w.en !== word.en)).slice(0,3).map(w => w.en)
  ]);
  return { type:'listening', audio:word.en, options, answer:word.en };
}

function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US';
  speechSynthesis.speak(u);
}

function renderTest() {
  const box = document.getElementById('test');
  box.style.display = 'block';
  box.innerHTML = '<h2>Test</h2>';

  questions.forEach((q,i) => {
    const div = document.createElement('div');
    div.className = 'question';

    if (q.type === 'meaning') {
      div.innerHTML = `<b>${i+1}. ${q.en}</b>`;
    } else {
      div.innerHTML = `<b>${i+1}. Listening</b> <button onclick="speak('${q.audio}')">üîä</button>`;
    }

    const optDiv = document.createElement('div');
    optDiv.className = 'options';

    q.options.forEach(opt => {
      const btn = document.createElement('button');
      btn.className = 'secondary';
      btn.innerText = opt;

      btn.onclick = () => {
        // clear previous highlight
        optDiv.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
        // highlight selected
        btn.classList.add('selected');
        answers[i] = opt;
      };

      optDiv.appendChild(btn);
    });

    div.appendChild(optDiv);
    box.appendChild(div);
  });

  const submit = document.createElement('button');
  submit.className = 'primary';
  submit.style.marginTop = '20px';
  submit.innerText = 'Submit';
  submit.onclick = submitTest;
  box.appendChild(submit);
}

function submitTest() {
  // disable all option buttons
  document.querySelectorAll('.options button').forEach(b => b.disabled = true);

  // disable submit button
  const submitBtn = document.querySelector('#test button.primary');
  if (submitBtn) submitBtn.disabled = true;

  let correct = 0;
  questions.forEach((q,i) => {
    if (answers[i] === q.answer) correct++;
  });

  const percent = Math.round(correct / questions.length * 100);
  let msg = 'C·∫ßn c·ªë g·∫Øng th√™m';
  if (percent >= 90) msg = 'B·∫°n l√†m r·∫•t t·ªët! üåü';
  else if (percent >= 75) msg = 'K·∫øt qu·∫£ r·∫•t kh√° üëç';
  else if (percent >= 60) msg = '·ªîn, c·∫ßn luy·ªán th√™m';
  else if (percent >= 40) msg = 'Ch∆∞a t·ªët l·∫Øm';

  const r = document.getElementById('result');
  r.style.display = 'block';
  r.innerHTML = `
    <h2>K·∫øt qu·∫£</h2>
    <p>${correct}/${questions.length} (${percent}%)</p>
    <p>${msg}</p>
    <br />
    <button class="primary" onclick="location.reload()">üîÑ Test l·∫°i</button>
  `;
}
</script>

</body>
</html>
